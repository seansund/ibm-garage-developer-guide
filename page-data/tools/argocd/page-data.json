{"componentChunkName":"component---src-pages-tools-argocd-index-mdx","path":"/tools/argocd/","result":{"pageContext":{"frontmatter":{"title":"Continuous Delivery with GitOps"},"relativePagePath":"/tools/argocd/index.mdx","titleType":"page","MdxNode":{"id":"d3a878f0-3423-58d9-8f96-30b190c8d100","children":[],"parent":"6afb4b3e-c58f-520d-8691-417488a71efb","internal":{"content":"---\ntitle: Continuous Delivery with GitOps\n---\n\nimport Globals from 'gatsby-theme-carbon/src/templates/Globals';\n\n<PageDescription>\n\nUse GitOps to continuously deliver application changes\n\n</PageDescription>\n\n[Argo CD](https://argoproj.github.io/argo-cd/) is a declarative, [GitOps](/getting-started-day-0/git-ops) [continuous delivery](/getting-started-day-2/continuous-delivery) \ntool for Kubernetes. The deployment environment is a namespace in a container platform like <Globals name=\"kube\" /> or <Globals name=\"ocp\" />. \nArgo CD models a collection of applications as a project and uses a Git repository to store the application's desired state. \nArgo CD is flexible in the structure of the application configuration represented in the Git repository.\n\nArgo CD supports defining Kubernetes manifests in a number of ways:\n- helm charts\n- kustomize\n- ksonnet\n- jsonnet\n- plain directory of yaml/json manifests\n- custom plugins\n\nArgo CD compares the actual state of the application in the cluster with the desired state defined in Git and determines if\nthey are out of sync. When it detects the environment is out of sync, Argo CD can be configured to either send out a \nnotification to kick off a separate reconciliation process or Argo CD can automatically synchronize the environments to \nensure they match. \n\n## Configuring GitOps with Argo CD\n\n**Terminology:**\n\nArgo CD uses a number of terms to refer to the components\n\n- Application - A deployable unit\n\n    In the context of the <Globals name=\"env\" />, an application is one Helm chart that contains one container image \n    that was produced by one CI pipeline. While Helm charts and images could certainly be combined to make more \n    sophisticated applications in more advanced scenarios, we will be using this simple definition here.\n    \n- Project - A collection of applications that make up a solution\n\n### Set up the GitOps repo\n\nArgo CD uses a Git repo to express the desired state of the Kubernetes environment. The basic setup uses one \nrepository to represent one [*project*](https://argoproj.github.io/argo-cd/user-guide/projects/). Within that \nrepository, each [*application*](https://argoproj.github.io/argo-cd/operator-manual/declarative-setup/#applications) \nthat makes up the project will be described in its own folder. The repository will also contain a branch for each \ndestination (i.e. cluster and namespace) into which we want to deploy the applications.\n\n<InlineNotification>\n\n**Note:** There is nothing special about a git repository used for git-ops. All that is required at a minimum is a hosted git\nrepository that is accessible from by the Argo CD instance.  The [Argo CD <Globals name=\"template\" />](https://github.com/IBM/template-argocd-gitops/generate) \nused in the following steps is optional and provides some application templates to help simplify some configuration activities.\n\n</InlineNotification>\n\n1. Create a new repo from the [Argo CD <Globals name=\"template\" />](https://github.com/IBM/template-argocd-gitops/generate)\n\n1. Clone the project to your machine\n\n1. Create a branch for the environment (e.g. `test` to configure the values for deployment to the testing environment)\n\n    ```shell script\n    git checkout -b test\n    ```\n\n1. Push the test branch up to the repository\n\n    ```shell script\n    git push -u origin test\n    ```\n\n### Hook the CI pipeline to the CD pipeline\n\nThe last stage in the CI pipeline updates a GitOps repository with the updated application metadata from the build. In\norder to do that, the CI pipeline needs to know which repository should be used and needs the credentials to push changes\nto that repository. As with other configuration within the pipeline, this is handled with config maps and secrets:\n\n- A secret named `git-credentials` holds the credentials the CI pipeline uses to access all the respositories in the Git host (e.g. GitHub, GitLab, BitBucket, etc).\nIf you used the [IGC CLI](/getting-started/cli) to register the pipeline then this secret has already been created.\n- A secret named `gitops-repo` holds the url and branch for the gitops repository.\n\nFortunately the [IGC CLI](/getting-started/cli) provides a `gitops` command to simplify this step. Information on how to use the\ncommand as well as the alternative manual steps can be found in the [IGC CLI gitops command](/getting-started/cli#gitops) section.\n\n1. Run the `gitops` command to create the config map and secret in the CI namespace\n\n    ```shell script\n    igc gitops\n    ```\n\n<InlineNotification>\n\n**Note:**\n\n- For the secret to be available to the CI pipeline, the secret needs to be created in the same namespace where the \npipeline is running.\n- The value provided for `branch` is the one the pipeline will use to when committing changes to trigger the CD \npipeline.\n\n</InlineNotification>\n\nAs of v2.0.0 of the Tekton tasks and the Jenkins pipelines, the CI pipeline will create a folder and the initial configuration\nfor an application deployment if it doesn't already exist. This means, there is no other manual configuration required\nto set up the repository.\n\n### Create a project in Argo CD (Optional)\n\nIn Argo CD terms, each deployable component is an application and applications are grouped into projects. Projects are not\nrequired for Argo CD to be able to deploy applications, but it helps to organize applications and provide some restrictions\non what can be done for applications that make up a project.\n\n<Tabs>\n<Tab label=\"Argo CD UI\">\n\n1. Log into the Argo CD user interface\n\n1. Click on the gear icon on the left menu to access the Settings options\n\n    ![Argo CD config](/images/argocd-config.png)\n\n1. Select the Projects option\n\n1. Press the New Project button at the top of the page\n\n1. Specify the properties for the new project\n\n    - Name - Provide the name for the project\n    - Description - A brief description of the project\n    - Source - Press Add source and pick the Git repository from the list that was added previously\n    - Destinations\n        - Add `https://kubernetes.default.svc` for the cluster url and `test` for the namespace\n        - Add `https://kubernetes.default.svc` for the cluster url and `staging` for the namespace\n    - Press Create\n\n    **Note:** Initially, the only cluster that is available is the one in which Argo CD is -\n    `https://kubernetes.default.svc`. By adding the two destinations we have allowed the project to be deployed\n    to both the `test` and `staging` namespaces within the current cluster.\n\n</Tab>\n<Tab label=\"Argo CD CLI\">\n\n1. Log in to the Argo CD CLI\n\n    ```shell script\n    argocd login {GRPC_INGRESS_HOST} --grpc-web [--sso]\n    ```\n    \n    where:\n    \n    - `GRPC_INGRESS_HOST` is the host name of the grpc endpoint. On <Global name=\"ocp\" /> this is the same as the UI host\n    - `--sso` is an optional flag used when sso authentication is enabled. If not using SSO then you will be prompted for\n    the username and password\n    \n    The grpc url and credentials can be retrieved from the `igc credentials` command\n\n2. Create the project\n    \n    ```shell script\n    argocd proj create {PROJECT} --dest {CLUSTER_HOST},{NAMESPACE} --src {GIT_REPO}\n    ```\n    \n    where:\n    \n    - `{PROJECT}` is the name you want to give to the project.\n    - `{CLUSTER_HOST}` is the url for the cluster server to which the project applications can be deployed. Use `https://kubernetes.default.svc` to reference the same cluster where ArgoCD has been deployed. `*` can also be used to allow deployments to any server.\n    - `{NAMESPACE}` is the namespace in the cluster where the applications can be deployed. `*` can be used to indicate any namespace.\n    - `{GIT_REPO}` is the url of the git repository where the gitops config will be located or `*` if you want to allow any.\n\n    **Note:** The `--dest` and `--src` arguments can be provided multiple times if there are multiple destations and/or\n    sources that should be configured for the project\n    \n</Tab>\n<Tab label=\"Argo CD custom resource\">\n\n1. Log in to the cluster from the command line\n\n2. Create a file named `project.yaml` with the following contents\n\n    ```yaml\n    apiVersion: argoproj.io/v1alpha1\n    kind: AppProject\n    metadata:\n      name: {PROJECT_NAME}\n    spec:\n      sourceRepos:\n        - '*'\n      destinations:\n        - namespace: '*'\n          server: https://kubernetes.default.svc\n    ```\n   \n   where:\n   \n   - `{PROJECT NAME}` is the name of the project\n\n3. Apply the yaml to the cluster in the namespace where Argo CD has been deployed (e.g. `tools`)\n\n    ```shell script\n    kubectl apply -f project.yaml -n tools\n    ```\n\n</Tab>\n</Tabs>\n\n### Add an application in Argo CD for each application component\n\nThe last step in the process is to define the application(s) within Argo CD that should be managed. This consists of\nconnecting the config within the Git repo to the cluster and namespace.\n\n<Tabs>\n<Tab label=\"Argo CD UI\">\n\n1. Log into Argo CD user interface\n\n1. Press `New Application` and provide the following values:\n\n    - `application name` - The name of the application. It is recommend to use the format of `{namespace}-{image name}`\n    - `project` - The project with which the application should be included\n    - `sync-policy` - The manner with which Argo CD will use to manage the deployed artifacts. `Automatic` is\n    recommended\n    - `repository url` - The Git url where the configuration is stored\n    - `revision` - The branch where the configuration for this instance is stored\n    - `path` - The path within the repository where the application config is located (should be the application name)\n    - `destination cluster` - The cluster url for the deployment\n    - `destination namespace` - The namespace where the application should be deployed\n\n1. Repeat that step for each application and each environment\n\n</Tab>\n<Tab label=\"Argo CD CLI\">\n\n1. Log in to the Argo CD CLI\n\n    ```shell script\n    argocd login {GRPC_INGRESS_HOST} --grpc-web [--sso]\n    ```\n    \n    where:\n    \n    - `GRPC_INGRESS_HOST` is the host name of the grpc endpoint. On <Global name=\"ocp\" /> this is the same as the UI host\n    - `--sso` is an optional flag used when sso authentication is enabled. If not using SSO then you will be prompted for\n    the username and password\n    \n    The grpc url and credentials can be retrieved from the `igc credentials` command\n\n2. Create an application\n\n    ```shell script\n    argocd app create {APP_NAME} --project {PROJECT} --repo {GIT_REPO} --path {APP_FOLDER} --dest-namespace {NAMESPACE} --dest-server {SERVER_URL}\n    ```\n    \n    where:\n    \n    - `{APP_NAME}` is the name you want to give the application\n    - `{PROJECT}` is the name of the project created above or \"default\"\n    - `{GIT_REPO}` is the url of the git repository where the gitops config is be located\n    - `{APP_FOLDER}` is the path to the configuration for the application in the gitops repo\n    - `{DEST_NAMESPACE}` is the target namespace in the cluster where the application will be deployed\n    - `{SERVER_URL}` is the url of the cluster where the application will be deployed. Use `https://kubernetes.default.svc` to reference the same cluster where ArgoCD has been deployed\n\n</Tab>\n<Tab label=\"Argo CD custom resource\">\n\n1. Log in to the cluster from the command line\n\n2. Create a file named `application.yaml` with the following contents\n\n    ```yaml\n    apiVersion: argoproj.io/v1alpha1\n    kind: Application\n    metadata:\n      name: {APPLICATION NAME}\n    spec:\n      destination:\n        namespace: {TARGET NAMESPACE}\n        server: {TARGET CLUSTER}\n      project: {PROJECT NAME}\n      source:\n        path: {APPLICATION PATH}\n        repoURL: {REPO URL}\n        targetRevision: {REPO BRANCH}\n        helm:\n          valueFiles:\n            - values.yaml\n      syncPolicy:\n        automated:\n          prune: true\n          selfHeal: true\n    ```\n   \n    where:\n   \n    - `{APPLICATION NAME}` is the name of the application\n    - `{PROJECT NAME}` is the name of the project (the one created in the previous step or `default`)\n    - `{TARGET NAMESPACE}` is the namespace where the application should be deployed\n    - `{TARGET CLUSTER}` is the server api url for the cluster where the application should be deployed. Use `https://kubernetes.default.svc` for the same cluter where Argo CD has been deployed\n    - `{APPLICATION PATH}`\n    - `{REPO URL}`\n    - `{REPO BRANCH}`\n\n3. Apply the yaml to the cluster in the namespace where Argo CD has been deployed (e.g. `tools`)\n\n    ```shell script\n    kubectl apply -f project.yaml -n tools\n    ```\n\n</Tab>\n</Tabs>\n\n### Configure another cluster as an Argo CD deployment target\n\nArgo CD supports deploying applications into clusters other than the one into which it has been installed. To do that,\nthe target cluster must first be registered with Argo CD. After that, the cluster api server can be selected as a\ndeployment target within an application configuration. The following describes the steps required to add another cluster\nas a deployment target:\n\n\n1. Log in to the Argo CD CLI\n\n    ```shell script\n    argocd login {GRPC_INGRESS_HOST} --grpc-web [--sso]\n    ```\n    \n    where:\n    \n    - `GRPC_INGRESS_HOST` is the host name of the grpc endpoint. On <Global name=\"ocp\" /> this is the same as the UI host\n    - `--sso` is an optional flag used when sso authentication is enabled. If not using SSO then you will be prompted for\n    the username and password\n    \n    The grpc url and credentials can be retrieved from the `igc credentials` command\n\n2. Log into the target cluster from the command line\n\n3. Run the Argo CD command to list the available clusters \n\n    ```shell script\n    argocd cluster add\n    ```\n    \n    The currently selected cluster will be the one with the asterisk next to it. Copy the cluster id from the table\n\n4. Add the cluster to Argo CD\n\n    ```shell script\n    argocd cluster add {CLUSTER ID}\n    ```\n   \n    where:\n    \n    - `{CLUSTER ID}` is the id of the target cluster from the previous step\n\n5. Confirm the configuration by listing the known clusters\n\n    ```shell script\n    argocd cluster list\n    ```\n","type":"Mdx","contentDigest":"ce3a1300ef4258a4f54f003dd469f9d9","counter":986,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"Continuous Delivery with GitOps"},"exports":{},"rawBody":"---\ntitle: Continuous Delivery with GitOps\n---\n\nimport Globals from 'gatsby-theme-carbon/src/templates/Globals';\n\n<PageDescription>\n\nUse GitOps to continuously deliver application changes\n\n</PageDescription>\n\n[Argo CD](https://argoproj.github.io/argo-cd/) is a declarative, [GitOps](/getting-started-day-0/git-ops) [continuous delivery](/getting-started-day-2/continuous-delivery) \ntool for Kubernetes. The deployment environment is a namespace in a container platform like <Globals name=\"kube\" /> or <Globals name=\"ocp\" />. \nArgo CD models a collection of applications as a project and uses a Git repository to store the application's desired state. \nArgo CD is flexible in the structure of the application configuration represented in the Git repository.\n\nArgo CD supports defining Kubernetes manifests in a number of ways:\n- helm charts\n- kustomize\n- ksonnet\n- jsonnet\n- plain directory of yaml/json manifests\n- custom plugins\n\nArgo CD compares the actual state of the application in the cluster with the desired state defined in Git and determines if\nthey are out of sync. When it detects the environment is out of sync, Argo CD can be configured to either send out a \nnotification to kick off a separate reconciliation process or Argo CD can automatically synchronize the environments to \nensure they match. \n\n## Configuring GitOps with Argo CD\n\n**Terminology:**\n\nArgo CD uses a number of terms to refer to the components\n\n- Application - A deployable unit\n\n    In the context of the <Globals name=\"env\" />, an application is one Helm chart that contains one container image \n    that was produced by one CI pipeline. While Helm charts and images could certainly be combined to make more \n    sophisticated applications in more advanced scenarios, we will be using this simple definition here.\n    \n- Project - A collection of applications that make up a solution\n\n### Set up the GitOps repo\n\nArgo CD uses a Git repo to express the desired state of the Kubernetes environment. The basic setup uses one \nrepository to represent one [*project*](https://argoproj.github.io/argo-cd/user-guide/projects/). Within that \nrepository, each [*application*](https://argoproj.github.io/argo-cd/operator-manual/declarative-setup/#applications) \nthat makes up the project will be described in its own folder. The repository will also contain a branch for each \ndestination (i.e. cluster and namespace) into which we want to deploy the applications.\n\n<InlineNotification>\n\n**Note:** There is nothing special about a git repository used for git-ops. All that is required at a minimum is a hosted git\nrepository that is accessible from by the Argo CD instance.  The [Argo CD <Globals name=\"template\" />](https://github.com/IBM/template-argocd-gitops/generate) \nused in the following steps is optional and provides some application templates to help simplify some configuration activities.\n\n</InlineNotification>\n\n1. Create a new repo from the [Argo CD <Globals name=\"template\" />](https://github.com/IBM/template-argocd-gitops/generate)\n\n1. Clone the project to your machine\n\n1. Create a branch for the environment (e.g. `test` to configure the values for deployment to the testing environment)\n\n    ```shell script\n    git checkout -b test\n    ```\n\n1. Push the test branch up to the repository\n\n    ```shell script\n    git push -u origin test\n    ```\n\n### Hook the CI pipeline to the CD pipeline\n\nThe last stage in the CI pipeline updates a GitOps repository with the updated application metadata from the build. In\norder to do that, the CI pipeline needs to know which repository should be used and needs the credentials to push changes\nto that repository. As with other configuration within the pipeline, this is handled with config maps and secrets:\n\n- A secret named `git-credentials` holds the credentials the CI pipeline uses to access all the respositories in the Git host (e.g. GitHub, GitLab, BitBucket, etc).\nIf you used the [IGC CLI](/getting-started/cli) to register the pipeline then this secret has already been created.\n- A secret named `gitops-repo` holds the url and branch for the gitops repository.\n\nFortunately the [IGC CLI](/getting-started/cli) provides a `gitops` command to simplify this step. Information on how to use the\ncommand as well as the alternative manual steps can be found in the [IGC CLI gitops command](/getting-started/cli#gitops) section.\n\n1. Run the `gitops` command to create the config map and secret in the CI namespace\n\n    ```shell script\n    igc gitops\n    ```\n\n<InlineNotification>\n\n**Note:**\n\n- For the secret to be available to the CI pipeline, the secret needs to be created in the same namespace where the \npipeline is running.\n- The value provided for `branch` is the one the pipeline will use to when committing changes to trigger the CD \npipeline.\n\n</InlineNotification>\n\nAs of v2.0.0 of the Tekton tasks and the Jenkins pipelines, the CI pipeline will create a folder and the initial configuration\nfor an application deployment if it doesn't already exist. This means, there is no other manual configuration required\nto set up the repository.\n\n### Create a project in Argo CD (Optional)\n\nIn Argo CD terms, each deployable component is an application and applications are grouped into projects. Projects are not\nrequired for Argo CD to be able to deploy applications, but it helps to organize applications and provide some restrictions\non what can be done for applications that make up a project.\n\n<Tabs>\n<Tab label=\"Argo CD UI\">\n\n1. Log into the Argo CD user interface\n\n1. Click on the gear icon on the left menu to access the Settings options\n\n    ![Argo CD config](/images/argocd-config.png)\n\n1. Select the Projects option\n\n1. Press the New Project button at the top of the page\n\n1. Specify the properties for the new project\n\n    - Name - Provide the name for the project\n    - Description - A brief description of the project\n    - Source - Press Add source and pick the Git repository from the list that was added previously\n    - Destinations\n        - Add `https://kubernetes.default.svc` for the cluster url and `test` for the namespace\n        - Add `https://kubernetes.default.svc` for the cluster url and `staging` for the namespace\n    - Press Create\n\n    **Note:** Initially, the only cluster that is available is the one in which Argo CD is -\n    `https://kubernetes.default.svc`. By adding the two destinations we have allowed the project to be deployed\n    to both the `test` and `staging` namespaces within the current cluster.\n\n</Tab>\n<Tab label=\"Argo CD CLI\">\n\n1. Log in to the Argo CD CLI\n\n    ```shell script\n    argocd login {GRPC_INGRESS_HOST} --grpc-web [--sso]\n    ```\n    \n    where:\n    \n    - `GRPC_INGRESS_HOST` is the host name of the grpc endpoint. On <Global name=\"ocp\" /> this is the same as the UI host\n    - `--sso` is an optional flag used when sso authentication is enabled. If not using SSO then you will be prompted for\n    the username and password\n    \n    The grpc url and credentials can be retrieved from the `igc credentials` command\n\n2. Create the project\n    \n    ```shell script\n    argocd proj create {PROJECT} --dest {CLUSTER_HOST},{NAMESPACE} --src {GIT_REPO}\n    ```\n    \n    where:\n    \n    - `{PROJECT}` is the name you want to give to the project.\n    - `{CLUSTER_HOST}` is the url for the cluster server to which the project applications can be deployed. Use `https://kubernetes.default.svc` to reference the same cluster where ArgoCD has been deployed. `*` can also be used to allow deployments to any server.\n    - `{NAMESPACE}` is the namespace in the cluster where the applications can be deployed. `*` can be used to indicate any namespace.\n    - `{GIT_REPO}` is the url of the git repository where the gitops config will be located or `*` if you want to allow any.\n\n    **Note:** The `--dest` and `--src` arguments can be provided multiple times if there are multiple destations and/or\n    sources that should be configured for the project\n    \n</Tab>\n<Tab label=\"Argo CD custom resource\">\n\n1. Log in to the cluster from the command line\n\n2. Create a file named `project.yaml` with the following contents\n\n    ```yaml\n    apiVersion: argoproj.io/v1alpha1\n    kind: AppProject\n    metadata:\n      name: {PROJECT_NAME}\n    spec:\n      sourceRepos:\n        - '*'\n      destinations:\n        - namespace: '*'\n          server: https://kubernetes.default.svc\n    ```\n   \n   where:\n   \n   - `{PROJECT NAME}` is the name of the project\n\n3. Apply the yaml to the cluster in the namespace where Argo CD has been deployed (e.g. `tools`)\n\n    ```shell script\n    kubectl apply -f project.yaml -n tools\n    ```\n\n</Tab>\n</Tabs>\n\n### Add an application in Argo CD for each application component\n\nThe last step in the process is to define the application(s) within Argo CD that should be managed. This consists of\nconnecting the config within the Git repo to the cluster and namespace.\n\n<Tabs>\n<Tab label=\"Argo CD UI\">\n\n1. Log into Argo CD user interface\n\n1. Press `New Application` and provide the following values:\n\n    - `application name` - The name of the application. It is recommend to use the format of `{namespace}-{image name}`\n    - `project` - The project with which the application should be included\n    - `sync-policy` - The manner with which Argo CD will use to manage the deployed artifacts. `Automatic` is\n    recommended\n    - `repository url` - The Git url where the configuration is stored\n    - `revision` - The branch where the configuration for this instance is stored\n    - `path` - The path within the repository where the application config is located (should be the application name)\n    - `destination cluster` - The cluster url for the deployment\n    - `destination namespace` - The namespace where the application should be deployed\n\n1. Repeat that step for each application and each environment\n\n</Tab>\n<Tab label=\"Argo CD CLI\">\n\n1. Log in to the Argo CD CLI\n\n    ```shell script\n    argocd login {GRPC_INGRESS_HOST} --grpc-web [--sso]\n    ```\n    \n    where:\n    \n    - `GRPC_INGRESS_HOST` is the host name of the grpc endpoint. On <Global name=\"ocp\" /> this is the same as the UI host\n    - `--sso` is an optional flag used when sso authentication is enabled. If not using SSO then you will be prompted for\n    the username and password\n    \n    The grpc url and credentials can be retrieved from the `igc credentials` command\n\n2. Create an application\n\n    ```shell script\n    argocd app create {APP_NAME} --project {PROJECT} --repo {GIT_REPO} --path {APP_FOLDER} --dest-namespace {NAMESPACE} --dest-server {SERVER_URL}\n    ```\n    \n    where:\n    \n    - `{APP_NAME}` is the name you want to give the application\n    - `{PROJECT}` is the name of the project created above or \"default\"\n    - `{GIT_REPO}` is the url of the git repository where the gitops config is be located\n    - `{APP_FOLDER}` is the path to the configuration for the application in the gitops repo\n    - `{DEST_NAMESPACE}` is the target namespace in the cluster where the application will be deployed\n    - `{SERVER_URL}` is the url of the cluster where the application will be deployed. Use `https://kubernetes.default.svc` to reference the same cluster where ArgoCD has been deployed\n\n</Tab>\n<Tab label=\"Argo CD custom resource\">\n\n1. Log in to the cluster from the command line\n\n2. Create a file named `application.yaml` with the following contents\n\n    ```yaml\n    apiVersion: argoproj.io/v1alpha1\n    kind: Application\n    metadata:\n      name: {APPLICATION NAME}\n    spec:\n      destination:\n        namespace: {TARGET NAMESPACE}\n        server: {TARGET CLUSTER}\n      project: {PROJECT NAME}\n      source:\n        path: {APPLICATION PATH}\n        repoURL: {REPO URL}\n        targetRevision: {REPO BRANCH}\n        helm:\n          valueFiles:\n            - values.yaml\n      syncPolicy:\n        automated:\n          prune: true\n          selfHeal: true\n    ```\n   \n    where:\n   \n    - `{APPLICATION NAME}` is the name of the application\n    - `{PROJECT NAME}` is the name of the project (the one created in the previous step or `default`)\n    - `{TARGET NAMESPACE}` is the namespace where the application should be deployed\n    - `{TARGET CLUSTER}` is the server api url for the cluster where the application should be deployed. Use `https://kubernetes.default.svc` for the same cluter where Argo CD has been deployed\n    - `{APPLICATION PATH}`\n    - `{REPO URL}`\n    - `{REPO BRANCH}`\n\n3. Apply the yaml to the cluster in the namespace where Argo CD has been deployed (e.g. `tools`)\n\n    ```shell script\n    kubectl apply -f project.yaml -n tools\n    ```\n\n</Tab>\n</Tabs>\n\n### Configure another cluster as an Argo CD deployment target\n\nArgo CD supports deploying applications into clusters other than the one into which it has been installed. To do that,\nthe target cluster must first be registered with Argo CD. After that, the cluster api server can be selected as a\ndeployment target within an application configuration. The following describes the steps required to add another cluster\nas a deployment target:\n\n\n1. Log in to the Argo CD CLI\n\n    ```shell script\n    argocd login {GRPC_INGRESS_HOST} --grpc-web [--sso]\n    ```\n    \n    where:\n    \n    - `GRPC_INGRESS_HOST` is the host name of the grpc endpoint. On <Global name=\"ocp\" /> this is the same as the UI host\n    - `--sso` is an optional flag used when sso authentication is enabled. If not using SSO then you will be prompted for\n    the username and password\n    \n    The grpc url and credentials can be retrieved from the `igc credentials` command\n\n2. Log into the target cluster from the command line\n\n3. Run the Argo CD command to list the available clusters \n\n    ```shell script\n    argocd cluster add\n    ```\n    \n    The currently selected cluster will be the one with the asterisk next to it. Copy the cluster id from the table\n\n4. Add the cluster to Argo CD\n\n    ```shell script\n    argocd cluster add {CLUSTER ID}\n    ```\n   \n    where:\n    \n    - `{CLUSTER ID}` is the id of the target cluster from the previous step\n\n5. Confirm the configuration by listing the known clusters\n\n    ```shell script\n    argocd cluster list\n    ```\n","fileAbsolutePath":"/home/runner/work/ibm-garage-developer-guide/ibm-garage-developer-guide/src/pages/tools/argocd/index.mdx"}}},"staticQueryHashes":["1364590287","2102389209","2102389209","2456312558","2746626797","2746626797","3018647132","3018647132","3037994772","3037994772","3273249464","63531786","63531786","768070550"]}